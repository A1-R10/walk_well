{% extends '_base.html' %}

{% block title %}
Walk Well
{% endblock %}

{% block content %}
<h1 class="text-center">Walk Well</h1>
<div id="map" class="mt-4" style="height: 500px;"></div>
{% endblock %}

{% block scripts %}
<script>
  // Map
  var map = L.map('map').setView([14.599512, 120.984222], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
  }).addTo(map);

  // map click event
  map.on('click', function(e) {
    console.log(e)
    var startMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
    
    // Will initialize the route
    map.on('click', function(e2) {
      console.log(e2)
      var endMarker = L.marker([e2.latlng.lat, e2.latlng.lng]).addTo(map);
      
      L.Routing.control({
        waypoints: [
          L.latLng(startMarker.getLatLng().lat, startMarker.getLatLng().lng),
          L.latLng(e2.latlng.lat, e2.latlng.lng)
        ]
      }).on('routesfound', function(e) {
        console.log(e)
        e.routes[0].coordinates.forEach(function(coord, index){
          setTimeout(() => {
            startMarker.setLatLng([coord.lat, coord.lng])
          }, 100 * index);
        })
      })  
      .addTo(map);
    }, { once: true });
  })
</script>
{% endblock %}